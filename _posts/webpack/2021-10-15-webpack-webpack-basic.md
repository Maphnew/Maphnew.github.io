---
title: "프론트엔드 개발환경의 이해와 실습 Section 2: Webpack(basic)"
date: 2021-10-06 22:16:00
categories:
  - Frontend
tags:
  - [Frontend, webpack]
toc: true
toc_sticky: true
---

# Section 2. 프론트엔드 개발환경의 이해: Webpack

<small>REF: [김정환님의 블로그](https://jeonghwan-kim.github.io/series/2019/12/10/frontend-dev-env-webpack-basic.html)</small>

## 1. 배경

문법 수준에서 모듈을 지원하기 시작한 것은 ES2015부터다.  
import/export 구문이 없었던 모듈 이전의 개발 방식은 index.html에 필요한 js파일을 script 태그로 모두 추가했다.

```html
<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script src="src/math.js"></script>
    <script src="src/app.js"></script>
  </body>
</html>
```

```js
// src/math.js
function sum(a, b) {
  return a + b;
}
```

```js
// src/app.js
console.log(sum(1, 2)); // 3
```

문제는 전역 스코프가 오염된다는 것

### 1.1 IIFE 방식의 모듈

[IIFE( Immediately Invoked Function Expression )](https://developer.mozilla.org/ko/docs/Glossary/IIFE)은 정의되자마자 즉시 실행되는 Javascript Function을 말한다.

```js
(function () {
  statement;
})();
```

IIFE로 변경해보자. 전역 스코프가 오염되지 않는다.

```js
// src/math.js
var math = math || {};

(function () {
  function sum(a, b) {
    return a + b;
  }
  math.sum = sum;
})();
```

```js
// src/app.js
console.log(math.sum(1, 2)); // 3
```

### 1.2 다양한 모듈 스펙

AMD와 CommonJS가 모듈을 구현하는 대표적인 명세이다.

CommonJS 대표적으로 Node.js에서 사용한다. exports 키워드로 모듈을 만들고 require() 함수로 불러들이는 방식이다.

```js
// src/math.js
exports function sum(a,b){return a+b}
```

```js
// src/app.js
const sum = require("./math.js");
console.log(sum(1, 2)); // 3
```

AMD(Asynchronous Module Definition)는 비동기로 로딩되는 환경에서 모듈을 사용하는 것이 목표이며 주로 브라우저 환경이다.

UMD(Universial Module Definition)는 AMD기반으로 CommonJS 방식까지 지원하는 통합 형태이다.

ES2015에서 표준 모듈 시스템을 내 놓았다. 지금은 바벨과 웹팩을 이용해 사용하는 것이 일반적이다.

```js
// src/math.js
export function sum(a, b) {
  return a + b;
}
```

```js
// src/app.js
import * as math from "./math.js";
console.log(math.sum(1, 2)); // 3
```

### 1.3 브라우저의 모듈 지원

크롬 브라우저에서 모듈을 사용하는 법

```html
<script type="module" src="src/app.js"></script>
```

CORS 오류가 난다면 lite-server 패키지를 설치해 실행해보자

크롬에서는 작동하지만 모든 브라우저에서 모듈 시스템을 지원하지 않는다. 웹팩이 필요하다.

## 2. 엔트리/아웃풋

웹팩은 여러개 파일을 하나로 합쳐주는 번들러(bundler)다. 하나의 시작점(entry point)으로부터 의존적인 모듈을 전부 찾아내서 하나의 결과물로 만든다. app.js -> math.js -> 1 file

webpack 설치하고 번들링 작업을 해보자

```
npm view webpack versions
npm install -D webpack@4.46.0 webpack-cli
```

아래의 버전이 설치되었다.

```json
  "devDependencies": {
    "webpack": "^4.46.0",
    "webpack-cli": "^4.9.0"
  }
```

help option 사용하기

```
$ node_modules/.bin/webpack --help
Usage: webpack [entries...] [options]
Alternative usage to run commands: webpack [command] [options]

The build tool for modern web applications.

Options:
  -c, --config <value...>                Provide path to a webpack configuration file e.g. ./webpack.config.js.
  --config-name <value...>               Name of the configuration to use.
  -m, --merge                            Merge two or more configurations using 'webpack-merge'.
  --env <value...>                       Environment passed to the configuration when it is a function.
  --node-env <value>                     Sets process.env.NODE_ENV to the specified value.
  --progress [value]                     Print compilation progress during build.
  -j, --json [value]                     Prints result as JSON or store it in a file.
  --entry <value...>                     The entry point(s) of your application e.g. ./src/main.js.
  -o, --output-path <value>              Output location of the file generated by webpack e.g. ./dist/.
  -t, --target <value>                   Sets the build target e.g. node.
  -d, --devtool <value>                  Determine source maps to use.
  --no-devtool                           Do not generate source maps.
  --mode <value>                         Defines the mode to pass to webpack.
  --name <value>                         Name of the configuration. Used when loading multiple configurations.
  --stats [value]                        It instructs webpack on how to treat the stats e.g. verbose.
  --no-stats                             Disable stats output.
  -w, --watch                            Watch for files changes.
  --no-watch                             Do not watch for file changes.
  --watch-options-stdin                  Stop watching when stdin stream has ended.
  --no-watch-options-stdin               Do not stop watching when stdin stream has ended.

Global options:
  --color                                Enable colors on console.
  --no-color                             Disable colors on console.
  -v, --version                          Output the version number of 'webpack', 'webpack-cli' and 'webpack-dev-server' and commands.
  -h, --help [verbose]                   Display help for commands and options.

Commands:
  build|bundle|b [entries...] [options]  Run webpack (default command, can be omitted).
  configtest|t [config-path]             Validate a webpack configuration.
  help|h [command] [option]              Display help for commands and options.
  info|i [options]                       Outputs information about your system.
  serve|server|s [entries...]            Run the webpack dev server. To see all available options you need to install 'webpack',
                                         'webpack-dev-server'.
  version|v [commands...]                Output the version number of 'webpack', 'webpack-cli' and 'webpack-dev-server' and commands.
  watch|w [entries...] [options]         Run webpack and watch for files changes.

To see list of all supported commands and options run 'webpack --help=verbose'.

Webpack documentation: https://webpack.js.org/.
CLI documentation: https://webpack.js.org/api/cli/.
Made with ♥ by the webpack team.

```

`--mode` 옵션 ['development', 'production', 'none']

`--entry` 옵션 - 시작점

`--output` 옵션 - 결과를 저장

```
$ node_modules/.bin/webpack --mode development --entry ./src/app.js --output-path dist
Hash: 9d440e075e5780b9c8d7
Version: webpack 4.46.0
Time: 86ms
Built at: 2021. 10. 15. 오후 9:04:09
  Asset      Size  Chunks             Chunk Names
main.js  4.81 KiB    main  [emitted]  main
Entrypoint main = main.js
[0] multi ./src/app.js 28 bytes {main} [built]
[./src/app.js] 69 bytes {main} [built]
[./src/math.js] 38 bytes {main} [built]
```

dist 폴더가 생성되었고 그 안에 main.js가 생성됨

```js
/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
// ...
```

index.html에 적용하고 브라우저에 띄워보자

```html
<script src="dist/main.js"></script>
```

매번 옵션을 터미널에 입력할 수 없으니 설정 문서를 만들자

`--config` 기본 옵션으로 file명은 webpack.config.js 이다.

```js
// webpack.config.js
const path = require("path");

module.exports = {
  mode: "development",
  entry: {
    main: "./src/app.js",
  },
  output: {
    path: path.resolve("./dist"),
    filename: "[name].js", // entry가 여러개일 경우 동적으로 생성될 수 있도록 한다.
  },
};
```

```json
// package.json
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "build": "webpack"
  },
```

```
$ npm run build

> sample@1.0.0 build
> webpack

Hash: 68e9e3eabbdf3e53fba5
Version: webpack 4.46.0
Time: 130ms
Built at: 2021. 10. 15. 오후 9:13:57
  Asset     Size  Chunks             Chunk Names
main.js  4.5 KiB    main  [emitted]  main
Entrypoint main = main.js
[./src/app.js] 69 bytes {main} [built]
[./src/math.js] 38 bytes {main} [built]
```

## 3. 로더

### 3.1 로더의 역할

모든 것을 자바스크립트의 모듈로 만들어 사용할 수 있게 한다.  
타입스크립트를 자바스크립트 문법으로 변환해 주거나 이미지를 data URL 형식의 문자열로 변환하고, CSS파일을 자바스크립트에서 직접 로딩할 수 있도록 한다.

### 3.2 커스텀 로더 만들기

```js
// my-webpack-loader.js
module.exports = function myWebpackLoader(content) {
  // console.log('myWebpackLoader')
  return content.replace("console.log(", "alert(");
};
```

```js
// webpack.config.js
{
  module: {
    rules: [
      {
        test: /\.js$/,
        use: [path.resolve("./my-webpack-loader.js")],
      },
    ];
  }
}
```

console.log를 alert으로 변환하는 로더를 만들었다.

## 4. 자주 사용하는 로더
